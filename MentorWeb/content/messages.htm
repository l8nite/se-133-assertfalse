<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Profile &middot; MentorWeb</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="../assets/css/bootstrap.css" rel="stylesheet">
    <link href="../assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="../assets/css/mentorweb.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }

      @media (max-width: 980px) {
        /* Enable use of floated navbar text */
        .navbar-text.pull-right {
          float: none;
          padding-left: 5px;
          padding-right: 5px;
        }
      }
    </style>
    <link href="../assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
                    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
                                   <link rel="shortcut icon" href="../assets/ico/favicon.png">
  </head>

  <body>

<div class="navbar-wrapper">
        <!-- Wrap the .navbar in .container to center it within the absolutely positioned parent. -->
        <div class="container">

        <div class="navbar navbar-inverse">
            <div class="navbar-inner">
            <!-- Responsive Navbar Part 1: Button for triggering responsive navbar (not covered in tutorial). Include responsive CSS to utilize. -->
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="brand" href="#">MentorWeb</a>
            <!-- Responsive Navbar Part 2: Place all navbar contents you want collapsed withing .navbar-collapse.collapse. -->
            <div class="nav-collapse collapse">
                <ul class="nav">
                <li class="active"><a href="#">Home</a></li>
                <!-- Read about Bootstrap dropdowns at http://twitter.github.com/bootstrap/javascript.html#dropdowns -->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Account <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="#">Edit Profile</a></li>
                    <li><a href="#">Manage Files</a></li>
                    <li><a href="#">Become a Mentor</a></li>
                    <li><a href="#">Upgrade to Premium</a></li>
                    <li class="divider"></li>
                    <li class="nav-header">Mentors</li>
                    <li><a href="#">Find a Mentor</a></li>
                    <li><a href="#">Review a Mentor</a></li>
                    <li><a href="#">Manage Mentors</a></li>
                    </ul>
                </li>
                <li><a href="#about">About</a></li>
                </ul>
            </div><!--/.nav-collapse -->
            </div><!-- /.navbar-inner -->
        </div><!-- /.navbar -->
        </div> <!-- /.container -->
    </div>

    <div class="container-fluid" style="margin-top:20px;">
      <div class="row-fluid">
        <div class="span3">
          <div class="well sidebar-nav">
            <ul id="friends" class="nav nav-list">
              <!-- TODO: make sure link color is right -->
              <li id="send-new-message-text" class="nav-header" style="color: blue;">Send new message</li>
              <li class="nav-header">Friends</li>
              <li><div class="divider" /></li>
            </ul>
          </div><!--/.well -->
        </div><!--/span-->
        <div class="span9" id="message-area" style="display: none;">
          <div class="row-fluid">
            <div class="span12">
              <h3 id="messages-with">Messages</h3>
              <div id="messages-list"></div>
              <p><input id="message-text"/>&nbsp;<a href="#" id="send-message-button" class="btn btn-primary btn-small">Send &raquo;</a></p>
            </div><!--/span-->
          </div><!--/row-->
        </div><!--/span-->
        <div class="span9" id="new-message-area" style="display: none;">
          <div class="row-fluid">
            <div class="span12">
              <h3>Send a new message</h3>
              <form class="form-horizontal">
                <div class="control-group">
                  <label class="control-label" for="inputTo">To</label>
                  <div class="controls">
                    <input type="text" id="inputTo" placeholder="To">
                  </div>
                </div>
                <div class="control-group">
                  <label class="control-label" for="inputMessage">Message</label>
                  <div class="controls">
                    <input type="text" id="inputMessage" placeholder="Message">
                  </div>
                </div>
                <div class="control-group">
                  <div class="controls">
                    <button type="submit" id="send-new-message-button" class="btn">Send &raquo;</button>
                  </div>
                </div>
              </form>
            </div><!--/span-->
          </div><!--/row-->
        </div><!--/span-->
      </div><!--/row-->
      </div><!--/row-->

      <hr>

      <footer>
        <p>&copy; MentorWeb 2013</p>
      </footer>

    </div><!--/.fluid-container-->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../assets/js/jquery.js"></script>
    <script src="../assets/js/bootstrap.js"></script>
    <script>
        var currentMessagesFrom = null;

        $(document).ready(function () {
          $.get('../../php/getcontacts.php', function(returnData) {
            var senders = $.parseJSON($.trim(returnData));
            for (var i = 0; i < senders.length; ++i) {
                console.log(senders[i]);
                var li = $('<li uuid="' + senders[i].uuid + '">' + senders[i].username + '</li>');
                li.click(function() {
                    displayMessagesFrom($(this).attr('uuid'));
                });
                $('#friends').append(li);
            }
          }, 'text');

          $('#send-message-button').click(function () {
            $.get('../../php/sendmessage.php', { 'to': currentMessagesFrom, 'm': $('#message-text').val() }, function () {
                displayMessagesFrom(currentMessagesFrom);
            });
          });

          $('#send-new-message-text').click(function () {
              $('#message-area').hide();
              $('#new-message-area').show();
          });

          $('#send-new-message-button').click(function () {
            $to = $('#inputTo').val();
            $m = $('#inputMessage').val();

            $.get('../../php/sendmessage.php', {'to': $to, 'm': $m}, function () {
                displayMessagesFrom($to);
            });
          });
        });

        function displayMessagesFrom(sender) {
          currentMessagesFrom = sender;
          $.get('../../php/getmessages.php', { 'from': sender }, function (returnData) {
              var response = $.parseJSON($.trim(returnData));
              console.log(response);
              $('#messages-with').html('Messages with ' + response.with);

              $('#messages-list').empty();
              for (var i = 0; i < response.messages.length; ++i) {
                  var message = response.messages[i];
                  var div = $('<div class="row-fluid"><div class="span1">' + message.time + '</div><div class="span3">' + message.name + '</div><div class="8">' + message.text + '</div></div>');
                  $('#messages-list').append(div);
              }
              $('#new-message-area').hide();
              $('#message-area').show();
          });
        }
  </script>
  </body>
</html>
